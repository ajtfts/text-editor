<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Text Editor</title>
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
		<textarea id="mainTextArea" rows="4" cols="50"></textarea>
		<script>
			const ipc = require('electron').ipcRenderer
			const {dialog} = require('electron').remote
			const fs = require('fs')

			const mainTextArea = document.getElementById("mainTextArea")

			let curFile

			function updateTitle() {
				if (curFile === undefined) {
					document.title = "Text Editor"
				} else {
					document.title = "Text Editor - "+curFile
				}
			}

			updateTitle()

			// enable tabbing on mainTextArea
			mainTextArea.onkeydown = (e) => {
				if (e.code == "Tab") {
					e.preventDefault()
					let start = mainTextArea.selectionStart
					let end = mainTextArea.selectionEnd

					mainTextArea.value = mainTextArea.value.substring(0, mainTextArea.selectionStart)
											+ '\t' 
											+ mainTextArea.value.substring(mainTextArea.selectionEnd, mainTextArea.value.length)
					mainTextArea.selectionStart = 
					mainTextArea.selectionEnd = start + 1
				}
			}

			ipc.on('newFile', () => {
				curFile = undefined
				mainTextArea.value = ""
				updateTitle()
			})

			ipc.on('openFile', () => {
				let options = {
					properties: ['openFile']
				}
				curFile = dialog.showOpenDialog(options)[0]
				fs.readFile(curFile, 'UTF-8', (err, data) => {
					mainTextArea.value = data
				})
				updateTitle()
			})

			ipc.on('saveFile', () => {
				if (curFile === undefined) {
					dialog.showSaveDialog((fileName) => {
						fs.writeFile(fileName, mainTextArea.value, (err) => {
							if (err) {
								alert(err)
							}
						})
					})
				} else {
					fs.writeFile(curFile, mainTextArea.value, (err) => {
						if (err) {
							alert(err)
						}
					})
				}
				updateTitle()
			})

			ipc.on('saveFileAs', () => {
				dialog.showSaveDialog((fileName) => {
					fs.writeFile(fileName, mainTextArea.value)
				})
				updateTitle()
			})
		</script>
	</body>
</html>